<?phpif (!defined('BASEPATH'))    exit('No direct script access allowed');require_once(COMMONPATH .        'core/lands_core.php');class login extends lands_core {    public $modulo = 'login';    public $mensagem;    public $redirector = null;    public $id_central = 94;    function __construct() {        parent::__construct();        $this->carrega_dados('login');    }    public function index($mensagem = null) {        if (isset($_REQUEST['redirect_link'])) {            $_REQUEST['redirect_link'] = addslashes($_REQUEST['redirect_link']);            $this->smarty->assign('redirect_link', $_REQUEST['redirect_link']);        }        if ($this->uri->segment(2)) {            $pagina_atual = $this->uri->segment(2);            $this->carrega_dados($pagina_atual);        }        if (isset($mensagem)) {            $this->smarty->assign('mensagem', $mensagem);        }        try {            $arquivo_layout = 'layout';            $this->model_smarty->render_modular($this->app->Template_txf, $arquivo_layout, $this->modulo, 'login');//            $this->model_smarty->render_avancado('login', $this->app->Template_txf, 'layout_login');        } catch (Exception $e) {            $this->model_smarty->render('login', 'padrao');        }    }    /*     * OBJETIVO: PROCURA o os usuarios para o cliente     * PARAMETROS: array of cliente ( tabela clientes do CORE )     * RETORNO: echo TPL form_login ou falso      */    function login_painel($id = null) {        $this->conecta_mbc($this->id_central);                //        $this->carrega_model('painel_model_login');        $this->load->model('painel_model_login');        $this->painel_model_login->inicializa($this->app, $this->cliente);        $this->load->model('painel_model_api');        $this->painel_model_api->inicializa($this->app, $this->cliente);        $us = addslashes($_POST['username']);        $password = addslashes($_POST['password']);        $usuario = $this->painel_model_login->autentica_usuario($us, $password);//        ver($_POST);//ver($usuario);        if ($usuario) {            if($this->painel_model_login->verifica_super_usuario($usuario)){            $usuario->Tipo='admin';        } else {            $usuario->Tipo='cliente';        }             $this->smarty->assign('mensagem', 'login_ok');            $this->smarty->assign('usuario', $usuario);            $this->session->set_userdata('usuario', $usuario);            $this->model_smarty->render_ajax_modular('msg_login', $this->app->Template_txf, $this->modulo);            $link = $this->app->Url_cliente;            if (isset($_REQUEST['redirect_link'])) {                $link.=$_REQUEST['redirect_link'];            }            redireciona($link);        } else {            $this->smarty->assign('mensagem', 'login_erro');            $this->model_smarty->render_ajax_modular('msg_login', $this->app->Template_txf, $this->modulo);        }    }    function logout() {        $this->session->unset_userdata('usuario');        if (isset($this->session->userdata['email']))            $this->session->unset_userdata('email');        if (isset($this->session->userdata['senha_temporaria']))            $this->session->unset_userdata('senha_temporaria');        if (isset($this->session->userdata['aposta']))            $this->session->unset_userdata('aposta');        $mensagem = '<div class="alert alert-danger">Deslogado com sucesso!</div>';        $this->index($mensagem);    }}