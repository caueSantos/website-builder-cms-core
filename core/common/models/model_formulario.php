<?phpclass Model_formulario extends CI_Model {    public $app;    public $cliente;    function __construct() {        parent::__construct();        $this->load->library('email');    }    function inicializa($app, $cliente = null) {        $this->app = $app;        if ($cliente) {            $this->cliente = $cliente;        }    }    function envia_formulario($app, $formulario = null) {        if (!isset($formulario)) {            die('Formulario nao foi passado por parÃ¢metro');        }        $this->app = $app;        $this->smarty->assign('post', $_POST);        try {            $caminho = COMMONPATH . "../templates/{$this->app->Template_txf}/forms/{$formulario}.tpl";            $caminho = str_replace("//", "/", $caminho);            $mensagem_formatada = $this->smarty->fetch($caminho);        } catch (Exception $e) {            $mensagem_formatada = $this->smarty->fetch(COMMONPATH . "../templates/padrao/forms/{$formulario}.tpl");        }//        ver($formulario);//        ver($_POST);//        ver($mensagem_formatada);        $dados = $_POST;        $dados['Mensagem_txa'] = $mensagem_formatada;        if (isset($_POST['Assunto_txf'])) {            $dados['Assunto_txf'] = $_POST['Assunto_txf'];        } else {            $dados['Assunto_txf'] = "Email enviado por $app->Titulo_txf";        }        return $this->envia_email($dados, 'boolean');    }    function envia_email($contato, $retorno = NULL) {        $this->load->library('email');// ver($this->cliente);        if ($this->cliente) {            $config = array(                'protocol' => 'smtp',                'smtp_host' => $this->cliente->Smtp_host_txf,                'smtp_port' => $this->cliente->Smtp_porta_txf,                'smtp_user' => $this->cliente->Smtp_usuario_txf,                'smtp_pass' => $this->cliente->Smtp_senha_txf,                'smtp_crypto' => $this->cliente->Smtp_seguranca_txf,//                                 'smtp_crypto' => 'ssl'            );//            $config['send_multipart']=FALSE;//            $config['crlf'] = "\r\n";            $config['newline'] = "\r\n";            $this->email->initialize($config);        } else {            die('sem cliente');        }        $this->email->from($this->cliente->Smtp_usuario_txf, $contato['Nome_txf']);        $this->email->reply_to($contato['Email_txf']);        $this->email->_replyto_flag = TRUE;//        $this->email->from($contato['Email_txf'], $contato['Nome_txf']);        if (isset($_POST['Destinatario_sel'])) {            $contato['Destinatario_txf'] = $_POST['Destinatario_sel'];        }        $this->email->to($contato['Destinatario_txf']);        $this->email->bcc($contato['Email_txf']);        $this->email->set_mailtype('html');        $this->email->subject($contato['Assunto_txf']);        $this->email->message($contato['Mensagem_txa']);//        ver($this->email);//        ver($config, 1);//        ver($this->email);        if ($this->email->send()) {            if ($retorno == 'boolean') {                return TRUE;            } else {                return $this->smarty->fetch("blocos/retorno-alert-success.tpl");            }        } else {            ver('nao enviou', 1);            ver($this->email, 1);            ver($this->email->print_debugger(), 1);            if ($retorno == 'boolean') {                return FALSE;            } else {                return $this->smarty->fetch("blocos/retorno-alert-error.tpl");            }        }    }    function envia_email_novo($email, $copia_cliente = TRUE) {        $this->load->library('email');        if ($this->cliente) {            $config = array(                'protocol' => 'smtp',                'smtp_host' => $this->cliente->Smtp_host_txf,                'smtp_port' => $this->cliente->Smtp_porta_txf,                'smtp_user' => $this->cliente->Smtp_usuario_txf,                'smtp_pass' => $this->cliente->Smtp_senha_txf,            );//                        $config['send_multipart']=FALSE;//            $config['crlf'] = "\r\n";            $config['newline'] = "\r\n";            $this->email->initialize($config);        }        $this->email->from($email['Email_txf'], $email['Nome_txf']);        $this->email->to($email['Destinatario_txf']);        $copias = 'leonel@landsdigital.com.br,gustavo.vedana@landsdigital.com.br';        if ($copia_cliente) {            $copias.=',' . $email['Email_txf'];        }        $this->email->bcc($copias);        $this->email->set_mailtype('html');        $this->email->subject($email['Assunto_txf']);        $this->email->message($email['Mensagem_txa']);        if ($this->email->send()) {            return TRUE;        } else {            echo $this->email->print_debugger();            return FALSE;        }    }}?>