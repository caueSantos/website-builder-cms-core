<?php	if (!defined('BASEPATH'))		exit('No direct script access allowed');	require COMMONPATH . 'third_party/instagram-php-scraper/vendor/autoload.php';	if (!function_exists('get_instagram_photos_new')) {		function get_instagram_photos_new($username = '', $limit = 10)		{//        error_reporting(E_ALL);			if (!is_lands()) {				return [];			}			$app = get_instance()->model_banco->app;			$instagram_token = isset($app->instagram_key) ? $app->instagram_key : null;			$url = 'https://graph.instagram.com/me/media?fields=id,media_type,caption,media_url,permalink,thumbnail_url&access_token=' . $instagram_token;			$data = curlContents($url);			$content = json_decode($data['contents']);			$i = 0;			foreach ($content->data as $media) {				if ($media->media_type === 'IMAGE') {					$photo = new stdClass();					$photo->shortcode = 'xlr8';					$photo->type = $media->media_type;					$photo->caption = $media->caption;					$photo->likes_count = 0;					$photo->comments_count = 0;					$photo->video_views = 0;					$photo->link = $media->permalink;					$photo->low = $media->media_url;					$photo->thumbnail = $media->thumbnail_url;					$photo->standard = $media->media_url;					$photo->high = $media->media_url;					$photo->square = $media->media_url;					$photos[] = $photo;					$i++;					if ($i == $limit) {						break;					}				}			}			return $photos;//        try {//            $instagram = new \InstagramScraper\Instagram();//            $medias = $instagram->getMedias($username, $limit);////            foreach ($medias as $media) {//                $photo = new stdClass();//                $photo->shortcode = $media->getShortCode();//                $photo->type = $media->getType();//                $photo->caption = $media->getCaption();//                $photo->likes_count = $media->getLikesCount();//                $photo->comments_count = $media->getCommentsCount();//                $photo->video_views = $media->getVideoViews();//                $photo->link = $media->getLink();//                $photo->low = $media->getImageLowResolutionUrl();//                $photo->thumbnail = $media->getImageThumbnailUrl();//                $photo->standard = $media->getImageStandardResolutionUrl();//                $photo->high = $media->getImageHighResolutionUrl();//                $photo->square = $media->getSquareImages();//                $photos[] = $photo;//            }//        } catch (\Exception $e) {////        }//        return $photos;		}	}	if (!function_exists('get_instagram_photos')) {		function get_instagram_photos($username = '', $limit = 10)		{//        error_reporting(E_ALL);//        if (!is_lands()) {//            return [];//        }			$app = get_instance()->model_banco->app;			$access_token = isset($app->instagram_key) ? $app->instagram_key : null;			// use this instagram access token generator http://instagram.pixelunion.net/			//$access_token = "4059671997.1677ed0.6f189c18e8e9450d99decbf9bd6fc335";			$json_link = "https://api.instagram.com/v1/users/self/media/recent/?";			$json_link .= "access_token={$access_token}&count={$limit}";			$json = file_get_contents($json_link);			$content = json_decode($json, false, 512, JSON_BIGINT_AS_STRING);			$i = 0;			foreach ($content->data as $media) {				$photo = new stdClass();				$photo->shortcode = 'xlr8';				$photo->type = $media->type;				$photo->caption = $media->caption->text;				$photo->likes_count = $media->likes->count;				$photo->comments_count = $media->comments->count;				$photo->video_views = 0;				$photo->link = $media->link;				$photo->low = $media->images->low_resolution->url;				$photo->thumbnail = $media->images->thumbnail->url;				$photo->standard = $media->images->standard_resolution->url;				$photo->high = $media->images->standard_resolution->url;				$photo->square = $media->images->standard_resolution->url;				$photos[] = $photo;				$i++;				if ($i == $limit) {					break;				}			}			return $photos;		}	}	if (!function_exists('instagram_access')) {		function instagram_access()		{			try {				if (isset($_GET['code'])) {					return instagram_get_token($_GET['code']);				} else {					header('location: ' . instagram_auth_url());				}			} catch (Exception $e) {				ver($e);			}		}	}	if (!function_exists('instagram_old_access')) {		function instagram_old_access()		{			try {				if (isset($_GET['code'])) {					$lands_id = $_GET['lands_id'];					if (!$lands_id) {						ver('lands id nao informado');					}					return instagram_get_old_token($lands_id, $_GET['code']);				} else {					$lands_id = get_instance()->uri->segments[2];					if (!$lands_id) {						ver('lands id nao informado');					}					header('location: ' . instagram_old_auth_url($lands_id));				}			} catch (Exception $e) {				ver($e);			}		}	}	if (!function_exists('instagram_auth_url')) {		function instagram_auth_url()		{			error_reporting(E_ALL);			$url = 'https://api.instagram.com/oauth/authorize';			$fields = array(				'app_id' => '2560621624030103',				'redirect_uri' => 'https://maquiagemqueen.com.br/insta',				'response_type' => 'code',				'scope' => 'user_profile,user_media'			);			$url .= '?' . http_build_query($fields);			return $url;		}	}	if (!function_exists('instagram_old_auth_url')) {		function instagram_old_auth_url($lands_id)		{			error_reporting(E_ALL);			$url = 'https://api.instagram.com/oauth/authorize/';			$fields = array(				'client_id' => '3de7b6a0540f4167a4dfe718e8782ea7',				'redirect_uri' => 'https://landsagenciaweb.com.br/instagram-token?lands_id=' . $lands_id,				'response_type' => 'code'			);			$url .= '?' . http_build_query($fields);			return $url;		}	}	if (!function_exists('instagram_get_old_token')) {		function instagram_get_old_token($lands_id, $code)		{			//error_reporting(E_ALL);//        $app = get_instance()->model_banco->app;			$banco = get_instance()->model_banco;			$url = 'https://api.instagram.com/oauth/access_token';			$fields = array(				'client_id' => '3de7b6a0540f4167a4dfe718e8782ea7',				'client_secret' => '52d883106a3c4efa80d64bc38efd81ea',				'redirect_uri' => 'https://landsagenciaweb.com.br/instagram-token?lands_id=' . $lands_id,				'code' => $code,				'grant_type' => 'authorization_code'			);			$ch = curl_init();			curl_setopt($ch, CURLOPT_URL, $url);			curl_setopt($ch, CURLOPT_POST, true);			curl_setopt($ch, CURLOPT_POSTFIELDS, $fields);			curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);			$result = curl_exec($ch);			curl_close($ch);			$data = json_decode($result);			if (!isset($data->error_message)) {				$token = $banco->executa_sql("SELECT * FROM apps_config WHERE Lands_id = '{$lands_id}' AND Campo_txf = 'instagram_key'");				if (empty($token)) {					$campos = [						'Lands_id' => $lands_id,						'Campo_txf' => 'instagram_key',						'Valor_txa' => $data->access_token					];					$token = $banco->db_insert('apps_config', $campos, true);				} else {					$campos = [						'Lands_id' => $lands_id,						'Campo_txf' => 'instagram_key',						'Valor_txa' => $data->access_token					];					$banco->set_basic_table('apps_config');					$token = $banco->updateTable('apps_config', $campos, 'Id_int', $token[0]->Id_int, true);				}			} else {				ver('Erro ao obter token do instagram!', 1);				ver($data);			}			ver('Token criado com sucesso', 1);			ver($lands_id, 1);			ver($token);		}	}	if (!function_exists('instagram_get_token')) {		function instagram_get_token($code)		{			error_reporting(E_ALL);			$app = get_instance()->model_banco->app;			$banco = get_instance()->model_banco;			$url = 'https://api.instagram.com/oauth/access_token';			$fields = array(				'app_id' => '2560621624030103',				'app_secret' => '75cc9bf1ac37de04ab426c7b8c4eb019',				'redirect_uri' => 'https://maquiagemqueen.com.br/insta',				'code' => $code,				'grant_type' => 'authorization_code'			);			$ch = curl_init();			curl_setopt($ch, CURLOPT_URL, $url);			curl_setopt($ch, CURLOPT_POST, true);			curl_setopt($ch, CURLOPT_POSTFIELDS, $fields);			curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);			$result = curl_exec($ch);			curl_close($ch);			$data = json_decode($result);			if (!isset($data->error_message)) {				$token = $banco->executa_sql("SELECT * FROM apps_config WHERE Lands_id = '{$app->Lands_id}' AND Campo_txf = 'instagram_key'");				if (empty($token)) {					$campos = [						'Lands_id' => $app->Lands_id,						'Campo_txf' => 'instagram_key',						'Valor_txa' => $data->access_token					];					$token = $banco->db_insert('apps_config', $campos, true);				} else {					$campos = [						'Lands_id' => $app->Lands_id,						'Campo_txf' => 'instagram_key',						'Valor_txa' => $data->access_token					];					$banco->set_basic_table('apps_config');					$token = $banco->updateTable('apps_config', $campos, 'Id_int', $token[0]->Id_int, true);				}			} else {				ver('Erro ao obter token do instagram!', 1);				ver($data);			}			ver('Token criado com sucesso', 1);			ver($token);		}	}